---
title: "DATA 607 Final Project: Predicting Financial Well Being"
author: "David Simbandumwe"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
editor_options: 
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(error = TRUE)

library(utils)

library(tidyverse)
library(tidymodels)
library(textrecipes)
library(discrim)
library(dplyr)
library(plyr)
library(naivebayes)

library(glue)
library(vip)

library(GGally)

```


# Overview



## Setup

```{r}

set.seed(1234)
rm(list=ls())

```



```{r, include=FALSE, error=TRUE}

fun_file_name <- glue(getwd(), "/ProjectFinal/DATA607_Functions.R")
source(fun_file_name, local = knitr::knit_global())

```



## Download and Tidy dataset from CFPB

```{r}

cfpb_df <- getCFPBFile()

cfpb_df <- slice_sample(cfpb_df,n=5000) 
#cfpb_df <- cfpb_df %>% select(-c(sample_pop,poverty_stat,fs_skills_score,fs_lm_score, fs_kh_score))




```





```{r}

# looks like the correlation breaks down by education level
ggscatmat(data=cfpb_df, corMethod = "spearman", alpha=0.2)
ggscatmat(data=cfpb_df, color="edu_level", corMethod = "spearman", alpha=0.2)
ggscatmat(data=cfpb_df, color="econ_hh_income", corMethod = "spearman", alpha=0.2)


```






```{r}

par(mfrow=c(2,2)) 


# econ_hh_income 
ggplot(cfpb_df, aes(x=econ_hh_income)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "econ_hh_income")

ggplot(cfpb_df, aes(x=econ_hh_income, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "econ_hh_income")


ggplot(cfpb_df,
    aes(cfpb_score, fill = econ_hh_income, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by econ_hh_income)")



# econ_save_rate
ggplot(cfpb_df, aes(x=econ_save_rate)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "econ_save_rate")

ggplot(cfpb_df, aes(x=econ_save_rate, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "econ_save_rate")

ggplot(cfpb_df,
    aes(cfpb_score, fill = econ_save_rate, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by econ_save_rate)")



# house_value
ggplot(cfpb_df, aes(x=house_value)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "house_value")

ggplot(cfpb_df, aes(x=house_value, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "house_value")

ggplot(cfpb_df,
    aes(cfpb_score, fill = house_value, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by house_value)")



# house_mortgage
ggplot(cfpb_df, aes(x=house_mortgage)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "house_mortgage")

ggplot(cfpb_df, aes(x=house_mortgage, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "house_mortgage")

ggplot(cfpb_df,
    aes(cfpb_score, fill = house_mortgage, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by house_mortgage)")



# age_8cat
ggplot(cfpb_df, aes(x=age_8cat)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "age_8cat")

ggplot(cfpb_df, aes(x=age_8cat, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "age_8cat")

ggplot(cfpb_df,
    aes(cfpb_score, fill = age_8cat, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by age_8cat)")



# race
ggplot(cfpb_df, aes(x=race)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "race")

ggplot(cfpb_df, aes(x=race, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "race")

ggplot(cfpb_df,
    aes(cfpb_score, fill = race, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by race)")


```




# Federal Reserve


## Download and Tidy dataset from FEd

```{r}

fed_df <- getFedFile()

fed_df <- slice_sample(fed_df,n=5000)
# fed_df <- fed_df %>% select(-c(age_4cat, age_7cat, starts_with("age_"),starts_with("hh_child_")
#                                ,race_census
#                                ))

fed_df <- fed_df %>% select(cfpb_score, econ_fin_ok, econ_skip_med, econ_pay_exp400, age, econ_saving, health)


```





```{r}

# looks like the correlation breaks down by education level
ggscatmat(data=fed_df, corMethod = "spearman", alpha=0.2)
ggscatmat(data=fed_df, color="econ_fin_ok", corMethod = "spearman", alpha=0.2)
ggscatmat(data=fed_df, color="econ_skip_med", corMethod = "spearman", alpha=0.2)


```







```{r}


# econ_fin_ok
ggplot(fed_df, aes(x=econ_fin_ok)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "econ_fin_ok")

ggplot(fed_df, aes(x=econ_fin_ok, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "econ_fin_ok")

ggplot(fed_df,
    aes(cfpb_score, fill = econ_fin_ok, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by econ_fin_ok)")



# econ_skip_med
ggplot(fed_df, aes(x=econ_skip_med)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "econ_skip_med")

ggplot(fed_df, aes(x=econ_skip_med, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "econ_skip_med")

ggplot(fed_df,
    aes(cfpb_score, fill = econ_skip_med, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by econ_skip_med)")




# econ_pay_exp400
ggplot(fed_df, aes(x=econ_pay_exp400)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "econ_pay_exp400")

ggplot(fed_df, aes(x=econ_pay_exp400, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "econ_pay_exp400")

ggplot(fed_df,
    aes(cfpb_score, fill = econ_pay_exp400, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by econ_pay_exp400)")


# age
ggplot(fed_df, aes(x=age)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "age")

ggplot(fed_df, aes(x=age, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "age")

ggplot(fed_df,
    aes(cfpb_score, fill = age, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by age)")




# econ_saving
ggplot(fed_df, aes(x=econ_saving)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "econ_saving")

ggplot(fed_df, aes(x=econ_saving, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  labs(title = "econ_saving")

ggplot(fed_df,
    aes(cfpb_score, fill = econ_saving, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by econ_saving)")


# health
ggplot(fed_df, aes(x=health)) +
  geom_bar(color="white", fill="black", alpha = 0.6, size = 0.1) +
  coord_flip() +
  labs(title = "health")

ggplot(fed_df, aes(x=health, y=cfpb_score)) +
  geom_point(alpha = 0.4, size = 1)+
  coord_flip() +
  geom_smooth() +
  labs(title = "health")

ggplot(fed_df,
    aes(cfpb_score, fill = health, y = stat(density))) +
    geom_histogram(binwidth = 1, alpha = 0.7, bins = 100, color="white",size = 0.1) +
    geom_vline(aes(xintercept = mean(cfpb_score)), linetype = "dashed", size = 0.2) +
    scale_fill_brewer(palette="Spectral") +
    labs(title = "CFPB Score (by health)")


```









# Analysis


# Conclusion
	
	
	
	
	
	
	
